<h2>Production Planning</h2>

<!-- New Plan Button -->
<button (click)="openPopupForAdd()">+ New Plan</button>

<!-- Plans Table -->
<table *ngIf="plans.length > 0">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Product</th>
      <th>Planned Qty</th>
      <th>Actual Qty</th>
      <th>Shift</th>
      <th>Assigned Operator</th>
      <th>Assigned Supervisor</th>
      <th>Date</th>
      <th>Line</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let plan of plans; let i = index">
      <td>{{ plan.orderId }}</td>
      <td>{{ plan.product }}</td>
      <td>{{ plan.plannedQty }}</td>
      <td>{{ plan.actualQty }}</td>
      <td>{{ plan.shift }}</td>
      <td>{{ plan.assignedOperator }}</td>
      <td>{{ plan.assignedSupervisor }}</td>
      <td>{{ plan.date }}</td>
      <td>{{ plan.line }}</td>
      <td>
        <span class="status-badge"
              [ngClass]="{
                'planned': plan.status === 'Planned',
                'in-progress': plan.status === 'In Progress',
                'completed': plan.status === 'Completed'
              }">
          {{ plan.status }}
        </span>
      </td>
      <td>
        <button class="edit-btn" (click)="openPopupForEdit(i)">Edit</button>
        <button class="delete-btn" (click)="deletePlan(i)">Delete</button>
      </td>
    </tr>
  </tbody>
</table>
<p *ngIf="plans.length === 0">No production plans added yet.</p>

<!-- Popup Modal -->
<div class="modal" *ngIf="showPopup">
  <div class="modal-content">
    <h3>{{ isEditMode ? 'Edit Production Plan' : 'New Production Plan' }}</h3>

    <form class="form-grid" [formGroup]="planForm" (ngSubmit)="savePlan()">
      <!-- Order ID -->
      <div class="form-field">
        <input formControlName="orderId" placeholder=" " />
        <label>Order ID</label>
        <small class="error" *ngIf="planForm.get('orderId')?.touched && planForm.get('orderId')?.invalid">Order ID is required</small>
      </div>

      <!-- Product -->
      <div class="form-field">
        <input formControlName="product" placeholder=" " />
        <label>Product Name / Code</label>
        <small class="error" *ngIf="planForm.get('product')?.touched && planForm.get('product')?.invalid">Product is required</small>
      </div>

      <!-- Planned Qty -->
      <div class="form-field">
        <input type="number" formControlName="plannedQty" placeholder=" " />
        <label>Planned Qty</label>
        <small class="error" *ngIf="planForm.get('plannedQty')?.touched && planForm.get('plannedQty')?.invalid">Planned Qty is required</small>
      </div>

      <!-- Actual Qty (optional) -->
      <div class="form-field">
        <input type="number" formControlName="actualQty" placeholder=" " />
        <label>Actual Qty</label>
      </div>

      <!-- Shift -->
      <div class="form-field">
        <select formControlName="shift">
          <option value="" disabled hidden></option>
          <option>Shift A</option>
          <option>Shift B</option>
          <option>Shift C</option>
        </select>
        <label>Shift</label>
        <small class="error" *ngIf="planForm.get('shift')?.touched && planForm.get('shift')?.invalid">Shift is required</small>
      </div>

      <!-- Assigned Operator -->
      <div class="form-field">
        <select formControlName="assignedOperator">
          <option value="" disabled hidden></option>
          <option>Ramu</option>
          <option>Raju</option>
          <option>Pavan</option>
        </select>
        <label>Assigned Operator</label>
        <small class="error" *ngIf="planForm.get('assignedOperator')?.touched && planForm.get('assignedOperator')?.invalid">Operator is required</small>
      </div>

      <!-- Assigned Supervisor -->
      <div class="form-field">
        <select formControlName="assignedSupervisor">
          <option value="" disabled hidden></option>
          <option>Naga</option>
          <option>Kumar</option>
          <option>Karthik</option>
        </select>
        <label>Assigned Supervisor</label>
        <small class="error" *ngIf="planForm.get('assignedSupervisor')?.touched && planForm.get('assignedSupervisor')?.invalid">Supervisor is required</small>
      </div>

      <!-- Date -->
      <div class="form-field">
        <input type="date" formControlName="date" placeholder=" " />
        <label>Date</label>
        <small class="error" *ngIf="planForm.get('date')?.touched && planForm.get('date')?.invalid">Date is required</small>
      </div>

      <!-- Line -->
      <div class="form-field">
        <select formControlName="line">
          <option value="" disabled hidden></option>
          <option>Machine 1</option>
          <option>Machine 2</option>
          <option>Machine 3</option>
        </select>
        <label>Machine</label>
        <small class="error" *ngIf="planForm.get('line')?.touched && planForm.get('line')?.invalid">Machine is required</small>
      </div>

      <!-- Status -->
      <div class="form-field">
        <select formControlName="status">
          <option value="" disabled hidden></option>
          <option>Planned</option>
          <option>In Progress</option>
          <option>Completed</option>
        </select>
        <label>Status</label>
        <small class="error" *ngIf="planForm.get('status')?.touched && planForm.get('status')?.invalid">Status is required</small>
      </div>

      <!-- Buttons -->
      <div class="form-buttons">
        <button type="submit">{{ isEditMode ? 'Update Plan' : 'Add Plan' }}</button>
        <button type="button" (click)="cancelPopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>
